{
  "success": false,
  "error": "PyTorch CUDA extension compilation failed: Traceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"<string>\", line 47, in <module>\nTypeError: load_inline() got an unexpected keyword argument 'cuda'\n",
  "provider": "colab",
  "timestamp": 1758478612.601272,
  "corrected_code": "import torch\nimport torch.nn as nn\nfrom torch.utils.cpp_extension import load_inline\n\n# CUDA kernel code\nkernel_code = \"\"\"\n#include <torch/extension.h>\n\n#define BLOCK_SIZE 32\n\n__global__ void matrixMultiplyKernel(const float *A, const float *B, float *C, int M, int N, int K) {\n  int row = blockIdx.y * blockDim.y + threadIdx.y;\n  int col = blockIdx.x * blockDim.x + threadIdx.x;\n\n  if (row < M && col < N) {\n    float sum = 0.0f;\n    for (int k = 0; k < K; ++k) {\n      sum += A[row * K + k] * B[k * N + col];\n    }\n    C[row * N + col] = sum;\n  }\n}\n\nstd::vector<torch::Tensor> matrixMultiply(torch::Tensor A, torch::Tensor B) {\n  int M = A.size(0);\n  int K = A.size(1);\n  int N = B.size(1);\n\n  auto C = torch::zeros({M, N}, A.options());\n\n  dim3 blockDim(BLOCK_SIZE, BLOCK_SIZE);\n  dim3 gridDim((N + BLOCK_SIZE - 1) / BLOCK_SIZE, (M + BLOCK_SIZE - 1) / BLOCK_SIZE);\n\n  matrixMultiplyKernel<<<gridDim, blockDim>>>(A.data_ptr<float>(), B.data_ptr<float>(), C.data_ptr<float>(), M, N, K);\n\n  cudaDeviceSynchronize();\n  return {C};\n}\n\nPYBIND11_MODULE(TORCH_EXTENSION_NAME, m) {\n  m.def(\"matrixMultiply\", &matrixMultiply, \"Matrix multiplication kernel\");\n}\n\"\"\"\n\n# Load the kernel\ntry:\n    custom_kernel = load_inline(\n        name=\"custom_matmul\",\n        cpp_sources=[kernel_code],\n        cuda=True,\n        verbose=True\n    )\nexcept RuntimeError as e:\n    print(f\"CUDA compilation failed: {e}\")\n    exit(1)\n\n\ndef custom_matmul_wrapper(A, B):\n    if not A.is_cuda or not B.is_cuda:\n        raise RuntimeError(\"Inputs must be CUDA tensors.\")\n    if A.dtype != torch.float32 or B.dtype != torch.float32:\n        raise RuntimeError(\"Inputs must be float32 tensors.\")\n    if A.dim() != 2 or B.dim() != 2:\n        raise RuntimeError(\"Inputs must be 2D tensors.\")\n    if A.size(1) != B.size(0):\n        raise RuntimeError(\"Incompatible matrix dimensions.\")\n\n    try:\n        result = custom_kernel.matrixMultiply(A, B)\n        return result[0]\n    except RuntimeError as e:\n        print(f\"CUDA kernel execution failed: {e}\")\n        exit(1)\n\n\n# Example usage\nif __name__ == \"__main__\":\n    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n    A = torch.randn(1024, 512, device=device, dtype=torch.float32)\n    B = torch.randn(512, 256, device=device, dtype=torch.float32)\n\n    try:\n        C = custom_matmul_wrapper(A, B)\n        print(\"Custom kernel result shape:\", C.shape)\n        #Further verification can be added here by comparing with standard matmul\n    except RuntimeError as e:\n      print(f\"Error during example usage: {e}\")\n      exit(1)"
}